(function(d){var e,i,j,v=1E5,k,l=50,r=navigator.userAgent.match(/MSIE/),m=d("<div id=resizerproxy>").mousemove(function(a){if(f&1){b.top+=-1*(j-a.pageY);var c=b.parentH-b.top-b.bottom-k;0>c&&(b.top+=c)}else f&4&&(b.bottom+=j-a.pageY,c=b.parentH-b.top-b.bottom-k,0>c&&(b.bottom+=c));f&8?(b.left+=-1*(i-a.pageX),c=b.parentW-b.left-b.right-160,0>c&&(b.left+=c)):f&2&&(b.right+=i-a.pageX,c=b.parentW-b.left-b.right-160,0>c&&(b.left+=c));i=a.pageX;j=a.pageY;s.css(b);return!1}).mouseup(function(){m.hide();
e.css(b).WM_ensure_viewable();e=void 0;return!1}),s=d("<div>").appendTo(m),b,f,w=function(a){var c=this.className.match(/resizer\-(\w+)/);if(2!=c.length)return!0;c=c[1];f=0;"t"==c[0]?f|=1:"b"==c[0]&&(f|=4);c.match(/l/)?f|=8:c.match(/r/)&&(f|=2);e=d(this).closest(".window").removeClass("minimized").removeClass("maximized").removeData("oldPos");k=e.find("> .windowtitlebar").height()+5;b=o(e);b.right=b.parentW-e.outerWidth()-b.left;b.bottom=b.parentH-e.outerHeight()-b.top;b.width=b.height="auto";i=a.pageX;
j=a.pageY;s.css(b);m.show();return!1},n=d("<div id=moverproxy>").mousemove(function(a){h.top+=-1*(j-a.pageY);h.left+=-1*(i-a.pageX);i=a.pageX;j=a.pageY;t.css(h);return!1}).mouseup(function(){n.hide();e.css(h).WM_ensure_viewable().removeClass("moving");e=void 0;return!1}),h={left:0,top:0,right:"auto",bottom:"auto",width:0,height:0},t=d("<div>").appendTo(n),p=0,x=function(a){if(a.button&&2==a.button)return!0;e=d(this).closest(".window");if(!r)var c=(new Date).getTime();if(250>=c-p)return p=0,e.triggerHandler("dblclick"),
!1;p=c;e.WM_raise();h=o(e);h.width=e.width();h.height=e.height();h.bottom=h.right="auto";t.css(h);n.show();i=a.pageX;j=a.pageY;return!1},o=function(a){a=a.offset();a.top-=d(document).scrollTop();a.left-=d(document).scrollLeft();a.parentW=d(window).width();a.parentH=d(window).height();return a},u=function(a){if(!a.data("oldPos")){var c=o(a);a.data("oldPos",{top:c.top,left:c.left,right:"auto",bottom:"auto",width:a.width(),height:a.height()})}},q=function(){return!1},y=function(){d(this).closest(".window").WM_raise();
return!0},z=function(){d(this).closest(".window").WM_minimize();return!1},A=function(){d(this).closest(".window").WM_restore();return!1},B=function(){d(this).closest(".window").WM_maximize();return!1},C=function(){d(this).closest(".window").WM_close();return!1},D=function(){var a=d(this).closest(".window");a.hasClass("maximized")?a.WM_restore():a.WM_maximize();return!1};n[0].onselectstart=m[0].onselectstart=q;d.fn.WM_ensure_viewable=function(){this.filter(".window").each(function(){var a=d(this),
c=o(a);0>c.top?a.css("top",0):20>c.parentH-c.top&&a.css("top",c.parentH-20);80>c.left+a.width()?a.css({left:-1*a.width()+80,width:a.width(),right:"auto"}):30>c.parentW-c.left&&a.css("left",c.parentW-30)});return this};d.fn.WM_minimize=function(){this.each(function(){var a=d(this);if(!a.is(".window"))return!0;a.removeClass("maximized");u(a);k=a.find(">.windowtitlebar").height()+5;a.css({left:"auto",top:"auto",right:0,width:300,height:k,zIndex:1E5}).removeClass("focused").addClass("minimized")});d.WM_retileMin();
return this};d.WM_retileMin=function(){d(".window.minimized").each(function(a){a*=k+2;d(this).css("bottom")!=a&&d(this).css("bottom",a)});return this};d.fn.WM_maximize=function(){var a;this.each(function(){var c=d(this);if(!c.is(".window"))return!0;c.hasClass("minimized")&&(c.removeClass("minimized"),a=1);u(c);c.css({left:0,top:0,bottom:0,right:0,width:"auto",height:"auto"}).WM_raise().addClass("maximized")});a&&d.WM_retileMin();return this};d.fn.WM_restore=function(){var a;this.each(function(){var c=
d(this);if(!c.is(".window"))return!0;c.hasClass("minimized")?(c.removeClass("minimized"),a=1):c.removeClass("maximized");c.css(c.data("oldPos")).removeData("oldPos").WM_ensure_viewable()});a&&d.WM_retileMin();this.WM_raise();return this};d.fn.WM_raise=function(){var a=this.filter(".window:first");if(0==a.length||a.hasClass("focused"))return this;d(".window.focused").removeClass("focused");a.addClass("focused").css("zIndex",++v);return this};d.fn.WM_close=function(){return this.filter(".window").remove()};
d.WM_open=function(a,c,b){b||(b={});var e=d("<div class=window><div class=windowtitlebar><img src=/favicon.ico width=16 height=16 class=titlebaricon><div class=titlebartext></div><div class=horizbuts><div class=minimizebut title=minimize></div><div class=restorebut title=restore></div><div class=maximizebut title=maximize></div><div class=closebut title=close></div></div></div><div class=windowcontent></div><div class=resizer-tl></div><div class=resizer-t></div><div class=resizer-tr></div><div class=resizer-r></div><div class=resizer-br></div><div class=resizer-b></div><div class=resizer-bl></div><div class=resizer-l></div></div>"),
g=b.name;if(!g&&a){var f=a.match(/([^\/]+)$/);f&&(g=f[1].replace(/\.[^\.]+$/,""))}g||(g=b.title||c);g&&(g=g.replace(/[^A-Za-z0-9]/g,""));g||(g="default");e.addClass("windowname_"+g);l+=10;400<l&&(l=50);e.css("top",l).css("left",l);d(".resizer-tl,.resizer-t,.resizer-tr,.resizer-r,.resizer-br,.resizer-b,.resizer-bl,.resizer-l",e).mousedown(w);e.click(y);g=d(".windowtitlebar",e);g.mousedown(x);g.dblclick(D);f=g.find("> .horizbuts").mousedown(q).children();f.eq(0).click(z);f.eq(1).click(A);f.eq(2).click(B);
f.eq(3).click(C);b=g.children(".titlebartext").text(b.title||a||"");b[0].onselectstart=q;b[0].unselectable="on";d(window.top.document.body).append(e);a&&("string"==typeof a?((b=a.match(/^(https?\:\/\/)([^\/]+)/))&&b[2]!=document.location.hostname&&e.find(".titlebaricon").attr("src",b[1]+b[2]+"/favicon.ico"),d('<iframe src="'+a+'" target="'+c+'"></iframe><div class=iframecover></div>').appendTo(e.find(".windowcontent"))):e.find(".windowcontent").append(a));e.WM_raise();return e};d(document).delegate("a",
"click",function(a){return(!a.button||0==a.button)&&this.target.match(/^\_child\b/)?(a=d(this),window.top.jQuery.WM_open(this.href,this.target,{title:a.attr("title")||a.text().substr(0,100)}),!1):!0});d(window).resize(function(){d(".window").WM_ensure_viewable();return!0});d(function(){r&&d(document.body).addClass("IE");d(document.body).append(n).append(m)})})(jQuery);

(function(d){var e,h,i,u=1E5,j,k=50,q=navigator.userAgent.match(/MSIE/),l=d("<div id=resizerproxy>").mousemove(function(a){if(f&1){b.top+=-1*(i-a.pageY);var c=b.parentH-b.top-b.bottom-j;0>c&&(b.top+=c)}else f&4&&(b.bottom+=i-a.pageY,c=b.parentH-b.top-b.bottom-j,0>c&&(b.bottom+=c));f&8?(b.left+=-1*(h-a.pageX),c=b.parentW-b.left-b.right-160,0>c&&(b.left+=c)):f&2&&(b.right+=h-a.pageX,c=b.parentW-b.left-b.right-160,0>c&&(b.left+=c));h=a.pageX;i=a.pageY;r.css(b);return!1}).mouseup(function(){l.hide();
e.css(b).WM_ensure_viewable();e=void 0;return!1}),r=d("<div>").appendTo(l),b,f,v=function(a){var c=this.className.match(/resizer\-(\w+)/);if(2!=c.length)return!0;c=c[1];f=0;"t"==c[0]?f|=1:"b"==c[0]&&(f|=4);c.match(/l/)?f|=8:c.match(/r/)&&(f|=2);e=d(this).closest(".window").removeClass("minimized").removeClass("maximized").removeData("oldPos");j=e.find("> .windowtitlebar").height()+5;b=n(e);b.right=b.parentW-e.outerWidth()-b.left;b.bottom=b.parentH-e.outerHeight()-b.top;b.width=b.height="auto";h=a.pageX;
i=a.pageY;r.css(b);l.show();return!1},m=d("<div id=moverproxy>").mousemove(function(a){g.top+=-1*(i-a.pageY);g.left+=-1*(h-a.pageX);h=a.pageX;i=a.pageY;s.css(g);return!1}).mouseup(function(){m.hide();e.css(g).WM_ensure_viewable().removeClass("moving");e=void 0;return!1}),g={left:0,top:0,right:"auto",bottom:"auto",width:0,height:0},s=d("<div>").appendTo(m),o=0,w=function(a){if(a.button&&2==a.button)return!0;e=d(this).closest(".window");if(!q)var c=(new Date).getTime();if(250>=c-o)return o=0,e.triggerHandler("dblclick"),
!1;o=c;e.WM_raise();g=n(e);g.width=e.width();g.height=e.height();g.bottom=g.right="auto";s.css(g);m.show();h=a.pageX;i=a.pageY;return!1},n=function(a){a=a.offset();a.top-=d(document).scrollTop();a.left-=d(document).scrollLeft();a.parentW=d(window).width();a.parentH=d(window).height();return a},t=function(a){if(!a.data("oldPos")){var c=n(a);a.data("oldPos",{top:c.top,left:c.left,right:"auto",bottom:"auto",width:a.width(),height:a.height()})}},p=function(){return!1},x=function(){d(this).closest(".window").WM_raise();
return!0},y=function(){d(this).closest(".window").WM_minimize();return!1},z=function(){d(this).closest(".window").WM_restore();return!1},A=function(){d(this).closest(".window").WM_maximize();return!1},B=function(){d(this).closest(".window").WM_close();return!1},C=function(){var a=d(this).closest(".window");a.hasClass("maximized")?a.WM_restore():a.WM_maximize();return!1};m[0].onselectstart=l[0].onselectstart=p;d.fn.WM_ensure_viewable=function(){this.filter(".window").each(function(){var a=d(this),
c=n(a);0>c.top?a.css("top",0):20>c.parentH-c.top&&a.css("top",c.parentH-20);80>c.left+a.width()?a.css({left:-1*a.width()+80,width:a.width(),right:"auto"}):30>c.parentW-c.left&&a.css("left",c.parentW-30)});return this};d.fn.WM_minimize=function(){this.each(function(){var a=d(this);if(!a.is(".window"))return!0;a.removeClass("maximized");t(a);j=a.find(">.windowtitlebar").height()+5;a.css({left:"auto",top:"auto",right:0,width:300,height:j,zIndex:1E5}).removeClass("focused").addClass("minimized")});d.WM_retileMin();
return this};d.WM_retileMin=function(){d(".window.minimized").each(function(a){a*=j+2;d(this).css("bottom")!=a&&d(this).css("bottom",a)});return this};d.fn.WM_maximize=function(){var a;this.each(function(){var c=d(this);if(!c.is(".window"))return!0;c.hasClass("minimized")&&(c.removeClass("minimized"),a=1);t(c);c.css({left:0,top:0,bottom:0,right:0,width:"auto",height:"auto"}).WM_raise().addClass("maximized")});a&&d.WM_retileMin();return this};d.fn.WM_restore=function(){var a;this.each(function(){var c=
d(this);if(!c.is(".window"))return!0;c.hasClass("minimized")?(c.removeClass("minimized"),a=1):c.removeClass("maximized");c.css(c.data("oldPos")).removeData("oldPos").WM_ensure_viewable()});a&&d.WM_retileMin();this.WM_raise();return this};d.fn.WM_raise=function(){var a=this.filter(".window:first");if(0==a.length||a.hasClass("focused"))return this;d(".window.focused").removeClass("focused");a.addClass("focused").css("zIndex",++u);return this};d.fn.WM_close=function(){return this.filter(".window").remove()};
d.WM_open=function(a,c,b){b||(b={});var e=d("<div class=window><div class=windowtitlebar><img src=/favicon.ico width=16 height=16 class=titlebaricon><div class=titlebartext></div><div class=horizbuts><div class=minimizebut title=minimize></div><div class=restorebut title=restore></div><div class=maximizebut title=maximize></div><div class=closebut title=close></div></div></div><div class=windowcontent></div><div class=resizer-tl></div><div class=resizer-t></div><div class=resizer-tr></div><div class=resizer-r></div><div class=resizer-br></div><div class=resizer-b></div><div class=resizer-bl></div><div class=resizer-l></div></div>"),
f=b.name||b.title||c||a;a&&(f=a.replace(/^https?:\/\/[^\/]+\//,"").replace(/\.\w+$/,"").replace(/[^A-Za-z0-9]/g,""));f||(f="default");e.addClass("windowname_"+f);k+=10;400<k&&(k=50);e.css("top",k).css("left",k);d(".resizer-tl,.resizer-t,.resizer-tr,.resizer-r,.resizer-br,.resizer-b,.resizer-bl,.resizer-l",e).mousedown(v);e.click(x);f=d(".windowtitlebar",e);f.mousedown(w);f.dblclick(C);var g=f.find("> .horizbuts").mousedown(p).children();g.eq(0).click(y);g.eq(1).click(z);g.eq(2).click(A);g.eq(3).click(B);
b=f.children(".titlebartext").text(b.title||a||"");b[0].onselectstart=p;b[0].unselectable="on";d(window.top.document.body).append(e);a&&("string"==typeof a?((b=a.match(/^(https?\:\/\/)([^\/]+)/))&&b[2]!=document.location.hostname&&e.find(".titlebaricon").attr("src",b[1]+b[2]+"/favicon.ico"),d('<iframe src="'+a+'" target="'+c+'"></iframe><div class=iframecover></div>').appendTo(e.find(".windowcontent"))):e.find(".windowcontent").append(a));e.WM_raise();return e};d(document).delegate("a","click",function(a){return(!a.button||
0==a.button)&&this.target.match(/^\_child\b/)?(a=d(this),window.top.jQuery.WM_open(this.href,this.target,{title:a.attr("title")||a.text().substr(0,100)}),!1):!0});d(window).resize(function(){d(".window").WM_ensure_viewable();return!0});d(function(){q&&d(document.body).addClass("IE");d(document.body).append(m).append(l)})})(jQuery);